<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MAWARAN CO</title>

<style>
body{font-family:tahoma;background:#f2f4f7;margin:0}
.container{
  max-width:420px;margin:auto;background:#fff;
  padding:16px;border-radius:12px;
  box-shadow:0 4px 10px #0002
}
h2{text-align:center}
label{display:block;margin-top:10px;font-weight:bold}
input,select,textarea,button{
  width:100%;padding:10px;margin-top:4px;
  border-radius:8px;border:1px solid #ccc;font-size:16px
}
input.error,select.error,textarea.error{
  border-color:red;background:#ffecec
}
button{background:#0a7cff;color:#fff;border:0;margin-top:15px}
#msg{text-align:center;margin-top:10px;font-weight:bold}
.hidden{display:none}

#topInfo{
  background:#eef;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  gap:6px;
  flex-wrap:wrap;
}
#topInfo span{font-weight:bold}
#editBtn{
  width:auto;
  padding:6px 10px;
  font-size:14px;
  background:#666;
}
#cityEdit{
  width:auto;
  padding:6px;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container">

<div id="login">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ *</label>
  <input id="repName">
  <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label>
  <input id="city">
  <button onclick="saveLogin()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="formBox" class="hidden">

<div id="topInfo">
  <span>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:</span><span id="repShow"></span> |
  <span>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</span><span id="cityShow"></span>
  <input id="cityEdit" class="hidden">
  <button id="editBtn" onclick="toggleEdit()">ØªØ¹Ø¯ÙŠÙ„</button>
</div>

<h2>MAWARAN CO</h2>

<label>Ù‡Ù„ ÙŠÙ…ØªÙ„Ùƒ Ø²ÙŠØª Ø±ÙŠÙ…Ø§ÙƒØ³ *</label>
<select id="useOil">
  <option value="">Ø§Ø®ØªØ±</option>
  <option>Ù†Ø¹Ù…</option>
  <option>Ù„Ø§</option>
</select>

<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ *</label>
<input id="tradeName">

<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ *</label>
<input id="ownerName">

<label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
<input id="address">

<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
<input id="phone" inputmode="numeric">

<label>Ø§Ù„ÙØ¦Ø© *</label>
<select id="category">
  <option value="">Ø§Ø®ØªØ±</option>
  <option>ÙƒØ±Ø§Ø¬</option>
  <option>Ø¬Ù…Ù„Ø©</option>
  <option>Ù…ÙØ±Ø¯</option>
</select>

<label>Ù…Ù„Ø§Ø­Ø¸Ø©</label>
<textarea id="note"></textarea>

<label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… *</label>
<select id="rate">
  <option value="">Ø§Ø®ØªØ±</option>
  <option value="1">â­</option>
  <option value="2">â­â­</option>
  <option value="3">â­â­â­</option>
  <option value="4">â­â­â­â­</option>
  <option value="5">â­â­â­â­â­</option>
</select>

<label>ÙƒÙ„ ÙƒÙ… ÙŠÙˆÙ… Ø²ÙŠØ§Ø±Ø© *</label>
<input id="visitDays" inputmode="numeric">

<label>Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØª</label>
<input id="oilType">

<label>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø²ÙŠØª</label>
<input id="oilGrade">

<label>Ø§Ù„Ù…Ø³Ø§ÙØ©</label>
<select id="oilDistance">
  <option value="">Ø§Ø®ØªØ±</option>
  <option>3 ÙƒÙ…</option>
  <option>5 ÙƒÙ…</option>
  <option>10 ÙƒÙ…</option>
  <option>15 ÙƒÙ…</option>
</select>

<label>Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±</label>
<input id="oilPrice" inputmode="numeric">

<!-- ğŸ“¸ Ø­Ù‚Ù„ Ø§Ù„ØµÙˆØ±Ø© -->
<label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ù„</label>
<input type="file" id="shopImage" accept="image/*" capture="environment">

<button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
<div id="msg"></div>

</div>
</div>

<script>
const URL="https://script.google.com/macros/s/AKfycbxh8HvDROdGIK9EpqR2dahMLfisZyZITtjWGq3MI-Lbe3IDkxYQHkBIqqxyO0eDLGcUYA/exec";

if(localStorage.repName){
  login.classList.add("hidden");
  formBox.classList.remove("hidden");
  repShow.textContent = localStorage.repName;
  cityShow.textContent = localStorage.city;
  cityEdit.value = localStorage.city;
}

function saveLogin(){
  if(!repName.value||!city.value)return;
  localStorage.repName=repName.value;
  localStorage.city=city.value;
  location.reload();
}

let editMode=false;
function toggleEdit(){
  editMode=!editMode;
  cityShow.classList.toggle("hidden",editMode);
  cityEdit.classList.toggle("hidden",!editMode);
  editBtn.textContent=editMode?"Ø­ÙØ¸":"ØªØ¹Ø¯ÙŠÙ„";
  if(!editMode){
    localStorage.city=cityEdit.value;
    cityShow.textContent=cityEdit.value;
  }
}

function send(){
  msg.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  navigator.geolocation.getCurrentPosition(async pos=>{
    let img="";
    if(shopImage.files[0]){
      const r=new FileReader();
      img=await new Promise(res=>{
        r.onload=()=>res(r.result);
        r.readAsDataURL(shopImage.files[0]);
      });
    }

    const data={
      repName:localStorage.repName,
      city:localStorage.city,
      tradeName:tradeName.value,
      ownerName:ownerName.value,
      useOil:useOil.value,
      address:address.value,
      phone:phone.value,
      category:category.value,
      note:note.value,
      rate:rate.value,
      visitDays:visitDays.value,
      lat:pos.coords.latitude,
      lng:pos.coords.longitude,
      oilType:oilType.value,
      oilGrade:oilGrade.value,
      oilDistance:oilDistance.value,
      oilPrice:oilPrice.value,
      image:img
    };

    fetch(URL,{method:"POST",body:JSON.stringify(data)})
    .then(r=>r.json())
    .then(res=>{
      msg.textContent=res.status==="success"
        ?"âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"
        :"âŒ "+res.message;
    });
  });
}
</script>

</body>
</html>
